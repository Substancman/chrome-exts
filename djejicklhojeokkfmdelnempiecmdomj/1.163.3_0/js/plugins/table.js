pluginFn['/js/plugins/v2/table.js'] = function(lucid, window) {
	var f=f||{};f.scope={};f.ASSUME_ES5=!1;f.ASSUME_NO_NATIVE_MAP=!1;f.ASSUME_NO_NATIVE_SET=!1;f.defineProperty=f.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,e){a!=Array.prototype&&a!=Object.prototype&&(a[b]=e.value)};f.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};f.global=f.getGlobal(this);f.SYMBOL_PREFIX="jscomp_symbol_";
f.initSymbol=function(){f.initSymbol=function(){};f.global.Symbol||(f.global.Symbol=f.Symbol)};f.symbolCounter_=0;f.Symbol=function(a){return f.SYMBOL_PREFIX+(a||"")+f.symbolCounter_++};f.initSymbolIterator=function(){f.initSymbol();var a=f.global.Symbol.iterator;a||(a=f.global.Symbol.iterator=f.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&f.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return f.arrayIterator(this)}});f.initSymbolIterator=function(){}};
f.arrayIterator=function(a){var b=0;return f.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};f.iteratorPrototype=function(a){f.initSymbolIterator();a={next:a};a[f.global.Symbol.iterator]=function(){return this};return a};
f.iteratorFromArray=function(a,b){f.initSymbolIterator();a instanceof String&&(a+="");var e=0,c={next:function(){if(e<a.length){var d=e++;return{value:b(d,a[d]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};
f.polyfill=function(a,b){if(b){var e=f.global;a=a.split(".");for(var c=0;c<a.length-1;c++){var d=a[c];d in e||(e[d]={});e=e[d]}a=a[a.length-1];c=e[a];b=b(c);b!=c&&null!=b&&f.defineProperty(e,a,{configurable:!0,writable:!0,value:b})}};f.polyfill("Array.prototype.keys",function(a){return a?a:function(){return f.iteratorFromArray(this,function(b){return b})}},"es6","es3");var m={CopyPasteUtils:function(){}};
m.CopyPasteUtils.tableSplit=function(a){for(var b=[[]],e=0,c=e,d=0,g=0,k=lucid.text.plainText(a);;)if(c==k.length||"\t"==k[c]||"\n"==k[c]||"\r"==k[c])if(c>e&&(b[d][g]=lucid.text.subContent(a,e,c)),c==a.t.length)break;else"\t"==a.t[c]?(b[d][g]||(b[d][g]=""),g+=1,e=c+1):(e!=c&&(g=0,d+=1,b.push([])),e="\r"==k[c]&&"\n"==a.t[c+1]?c+2:c+1),c=e;else c+=1;b.length&&0===b[b.length-1].length&&b.pop();return function(b){var a=b[0].length;return lucid.array.every(b,function(b){return b.length==a})?b:!1}(b)};var u={common:{}};u.common.Table={};u.common.Table.cache={};u.common.Table.locationCache={};u.common.Table.lastSelected=null;
u.common.Table.getSelectedTables=function(a,b){if(b){for(var e=lucid.plugin.getSelection(),c=[];e.length;)(b=e.pop())&&(lucid.plugin.getBlockClassName(b)==a.BLOCKNAME?c.push(b):lucid.plugin.getChildren(b,function(b){lucid.plugin.getBlockClassName(b)==a.BLOCKNAME?c.push(b):lucid.plugin.isGroup(b)&&e.push(b)}));return c}return lucid.array.filter(lucid.plugin.getSelection(),function(b){return lucid.plugin.getBlockClassName(b)==a.BLOCKNAME})};
u.common.Table.hasMultipleTablesSelected=function(a,b){return 1!==u.common.Table.getSelectedTables(a,void 0===b?!1:b).length};
u.common.Table.getVisibleCells=function(a,b){function e(b){return lucid.plugin.getProperty(a,b)}if(u.common.Table.cache[a])return u.common.Table.cache[a];b&&(e=function(a){return b[a]});e("BoundingBox");var c=e("ColWidths"),d=e("RowHeights"),g=e("Rows"),k=e("Cols");u.common.Table.cache[a]={};u.common.Table.locationCache[a]={};for(var l=u.common.Table.cache[a],h=0,v=0,n=[],p=[0],r=[0],q=0;q<g;q++){n.push([]);v+=d[q];r.push(v);for(var t=0;t<k;t++)n[q].push(void 0)}for(t=0;t<k;t++)h+=c[t],p.push(h);
v=h=0;var w={};for(q=0;q<g;q++){for(t=0;t<k;t++){var x=q+","+t;if(void 0===n[q][t]){var y=e("CellSize_"+x);if(!y)return l;n[q][t]=x;w[q+","+t]=x;if(1<y.w||1<y.h)for(var z=0;z<y.w&&z+t<k;z++)for(var A=0;A<y.h&&A+q<g;A++)n[q+A][t+z]=x,w[q+A+","+(t+z)]=x;l[x]={x:h,y:v,w:Math.round(p[t+y.w]-p[t]),h:Math.round(r[q+y.h]-r[q]),row:q,col:t,size:y}}h+=c[t]}h=0;v+=d[q]}u.common.Table.locationCache[a]=w;return l};
u.common.Table.getCellLocations=function(a){if(u.common.Table.locationCache[a])return u.common.Table.locationCache[a];u.common.Table.getVisibleCells(a);return u.common.Table.locationCache[a]};u.common.Table.clearCellCache=function(a){delete u.common.Table.cache[a];delete u.common.Table.locationCache[a]};
u.common.Table.getVisibleSelectedCells=function(a){var b=lucid.plugin.getProperty(a,"SelectedCells",!0);a=u.common.Table.getVisibleCells(a);0<Object.keys(b).length&&(a=lucid.object.filter(a,function(a,c){return b[c]}));return a};
u.common.Table.copyCell=function(a,b,e,c){lucid.plugin.setPropertyIfChanged(a,"CellFill_"+e,c["CellFill_"+b]);lucid.plugin.setPropertyIfChanged(a,"CellSize_"+e,c["CellSize_"+b]);lucid.plugin.setPropertyIfChanged(a,"NoBand_"+e,c["NoBand_"+b]);lucid.plugin.setPropertyIfChanged(a,"Cell_"+e,c["Cell_"+b])};
u.common.Table.addColumn=function(a,b,e,c,d){if(e.Cols<a.MAXCOLS){a=e.ColWidths;d=d?c.col:c.col+c.size.w;lucid.plugin.setProperty(b,"Cols",e.Cols+1);a.splice(c.col,0,a[c.col]);lucid.plugin.setProperty(b,"ColWidths",a);for(var g=e.Cols;g>d;g--)for(c=0;c<e.Rows;c++)u.common.Table.copyCell(b,c+","+(g-1),c+","+g,e);g=d;for(c=0;c<e.Rows;c++)lucid.plugin.setProperty(b,"Cell_"+c+","+g,""),lucid.plugin.setProperty(b,"CellSize_"+c+","+g,{w:1,h:1});e=u.common.Table.getVisibleCells(b);lucid.object.forEach(e,
function(a){a.col<g&&a.col+a.size.w>g&&lucid.plugin.setProperty(b,"CellSize_"+a.row+","+a.col,{w:a.size.w+1,h:a.size.h})})}};
u.common.Table.deleteColumn=function(a,b,e,c){if(1==e.Cols)u.common.Table.setSelection(a,b,{}),lucid.plugin.deleteItem(b);else{for(var d=e.ColWidths,g=c;g<e.Cols-1;g++)for(var k=0;k<e.Rows;k++){var l=k+","+g,h=k+","+(g+1);1<e["CellSize_"+l].w&&(e["CellSize_"+h]=e["CellSize_"+l],e["CellSize_"+h].w--);u.common.Table.copyCell(b,h,l,e)}if(a.CLEARDELETEDCELLS)for(k=0;k<e.Rows;k++)lucid.plugin.setPropertyIfChanged(b,"Cell_"+k+","+(e.Cols-1),"");a=u.common.Table.getVisibleCells(b);lucid.object.forEach(a,
function(a){a.col<c&&a.col+a.size.w>c&&lucid.plugin.setProperty(b,"CellSize_"+a.row+","+a.col,{w:a.size.w-1,h:a.size.h})});lucid.plugin.setProperty(b,"Cols",e.Cols-1);d.splice(c,1);lucid.plugin.setProperty(b,"ColWidths",d)}};
u.common.Table.addRow=function(a,b,e,c,d){if(e.Rows<a.MAXROWS){a=e.RowHeights;d=d?c.row:c.row+c.size.h;lucid.plugin.setProperty(b,"Rows",e.Rows+1);a.splice(c.row,0,a[c.row]);lucid.plugin.setProperty(b,"RowHeights",a);for(var g=e.Rows;g>d;g--)for(c=0;c<e.Cols;c++)u.common.Table.copyCell(b,g-1+","+c,g+","+c,e);g=d;for(c=0;c<e.Cols;c++)d=g+","+c,lucid.plugin.setProperty(b,"Cell_"+d,""),lucid.plugin.setProperty(b,"CellSize_"+d,{w:1,h:1});e=u.common.Table.getVisibleCells(b);lucid.object.forEach(e,function(a){a.row<
g&&a.row+a.size.h>g&&lucid.plugin.setProperty(b,"CellSize_"+a.row+","+a.col,{w:a.size.w,h:a.size.h+1})})}};
u.common.Table.deleteRow=function(a,b,e,c){if(1==e.Rows)u.common.Table.setSelection(a,b,{}),lucid.plugin.deleteItem(b);else{for(var d=e.RowHeights,g=c;g<e.Rows-1;g++)for(var k=0;k<e.Cols;k++){var l=g+","+k,h=g+1+","+k;1<e["CellSize_"+l].h&&(e["CellSize_"+h]=e["CellSize_"+l],e["CellSize_"+h].h--);u.common.Table.copyCell(b,h,l,e)}if(a.CLEARDELETEDCELLS)for(k=0;k<e.Cols;k++)lucid.plugin.setPropertyIfChanged(b,"Cell_"+(e.Rows-1)+","+k,"");a=u.common.Table.getVisibleCells(b);lucid.object.forEach(a,function(a){a.row<
c&&a.row+a.size.h>c&&lucid.plugin.setProperty(b,"CellSize_"+a.row+","+a.col,{w:a.size.w,h:a.size.h-1})});lucid.plugin.setProperty(b,"Rows",e.Rows-1);d.splice(c,1);lucid.plugin.setProperty(b,"RowHeights",d)}};
u.common.Table.pasteCells=function(a,b,e,c,d,g){var k=d[0].length+c,l=d.length+e,h=lucid.plugin.getProperty(b,"Rows"),v=lucid.plugin.getProperty(b,"Cols");l>h&&lucid.plugin.setProperty(b,"Rows",Math.min(a.MAXROWS,l));k>v&&lucid.plugin.setProperty(b,"Cols",Math.min(a.MAXCOLS,k));for(k=0;k<d.length&&e+k<a.MAXROWS;k++)for(l=0;l<d[k].length&&c+l<a.MAXCOLS;l++)h=e+k+","+(c+l),lucid.plugin.setProperty(b,"Cell_"+h,d[k][l]),g&&g[k][l]&&lucid.plugin.setProperty(b,"CellFill_"+h,g[k][l]);lucid.text.blurEditor();
lucid.log.analytics("tables.pastetsv")};u.common.Table.hasMergedCellsSelected=function(a){var b=lucid.plugin.getProperty(a,"SelectedCells",!0);b=Object.keys(b);for(var e=0;e<b.length;e++){var c=lucid.plugin.getProperty(a,"CellSize_"+b[e]);if(1<c.w||1<c.h)return!0}return!1};
u.common.Table.getPackedSelectionBounds=function(a,b){b=b||lucid.plugin.getProperty(a,"SelectedCells",!0);a=lucid.object.getKeys(b);a=a.filter(function(a){return b[a]});if(!a.length)return null;a=lucid.array.map(a,function(b){return u.common.Table.keyToCoordinates(b)});for(var e in a){var c=a[e];if(d)c.row<d.row?d.row=c.row:c.row>g.row&&(g.row=c.row),c.col<d.col?d.col=c.col:c.col>g.col&&(g.col=c.col);else{var d={row:c.row,col:c.col};var g={row:c.row,col:c.col}}}if(!d||!g)return null;for(e=d.row;e<=
g.row;e++)for(a=d.col;a<=g.col;a++)if(!b[e+","+a])return null;return{start:d,end:g}};u.common.Table.canMergeCells=function(a){var b=u.common.Table.getPackedSelectionBounds(a);if(!b||b.start.row==b.end.row&&b.start.col==b.end.col)return!1;a=lucid.plugin.getProperty(a,"CellSize_"+b.start.row+","+b.start.col);return b.start.row+a.h-1==b.end.row&&b.start.col+a.w-1==b.end.col?!1:!0};
u.common.Table.mergeCells=function(a){if(u.common.Table.canMergeCells(a)){for(var b=lucid.plugin.getProperty(a,"SelectedCells",!0),e=lucid.plugin.getProperty(a,"Rows"),c=lucid.plugin.getProperty(a,"Cols"),d,g=0;g<e;g++)for(var k=0;k<c;k++)if(b[g+","+k]){d||(d={r:g,c:k});var l=g;var h=k}lucid.plugin.setPropertyIfChanged(a,"CellSize_"+d.r+","+d.c,{w:h-d.c+1,h:l-d.r+1})}};
u.common.Table.unMergeCells=function(a){for(var b=lucid.plugin.getProperty(a,"SelectedCells",!0),e=lucid.plugin.getProperty(a,"Rows"),c=lucid.plugin.getProperty(a,"Cols"),d=0;d<e;d++)for(var g=0;g<c;g++)if(b[d+","+g]){var k=lucid.plugin.getProperty(a,"CellSize_"+d+","+g);1==k.w&&1==k.h||lucid.plugin.setProperty(a,"CellSize_"+d+","+g,{w:1,h:1})}};
u.common.Table.deselectAllCells=function(a,b){for(var e=0;e<b.length;e++)lucid.plugin.getDescendants(b[e]).forEach(function(b){if(lucid.plugin.getBlockClassName(b)==a.BLOCKNAME){var c=lucid.plugin.getProperty(b,"SelectedCells",!0);0<Object.keys(c).length&&u.common.Table.setSelection(a,b,{})}});u.common.Table.lastSelected=null};
u.common.Table.canDeleteColumn=function(a){a=u.common.Table.getSelectedTables(a);if(1!==a.length)return!1;var b=!0;lucid.array.forEach(a,function(a){a=lucid.object.getValues(u.common.Table.getVisibleSelectedCells(a));if(0==a.length)b=!1;else{var c=a[0].col;lucid.array.every(a,function(b){return b.col==c})||(b=!1)}});return b};
u.common.Table.canDeleteRow=function(a){a=u.common.Table.getSelectedTables(a);if(1!==a.length)return!1;var b=!0;lucid.array.forEach(a,function(a){a=lucid.object.getValues(u.common.Table.getVisibleSelectedCells(a));if(0==a.length)b=!1;else{var c=a[0].row;lucid.array.every(a,function(b){return b.row==c})||(b=!1)}});return b};
u.common.Table.updateTextAreaIndexes=function(a,b){b=lucid.object.getValues(b);lucid.array.sort(b,function(b,a){return b.row-a.row||b.col-a.col});b=lucid.array.map(b,function(b){return"Cell_"+b.row+","+b.col});lucid.plugin.setBlockTextAreasOrder(a,b)};u.common.Table.setSelection=function(a,b,e){a.PRESELECT&&a.PRESELECT(b,e);lucid.plugin.setProperty(b,"SelectedCells",e,!0);a.POSTSELECT&&a.POSTSELECT(b);lucid.plugin.proxyPropertyChanged(b,"FillColor");a.FILTERTEXTONSELECT&&lucid.plugin.filteredTextAreasChanged(b)};
u.common.Table.createCell=function(a,b,e,c){var d=e+","+c;e={id:"Cell_"+d,value:"",expandButton:!1,getBoundingBox:function(a){var c=u.common.Table.getVisibleCells(b)[d];if(!c)return null;var e=lucid.plugin.getProperty(b,"InsetMargin");return{x:a.x+c.x+e,y:a.y+c.y+e,w:c.w-2*e,h:c.h-2*e,hideOverflow:!0}}};a.SELECTONFOCUS&&(e.onFocus=function(){var c={};c[d]=!0;u.common.Table.setSelection(a,b,c)});lucid.plugin.addBlockTextArea(b,e);void 0===lucid.plugin.getProperty(b,"CellFill_"+d)&&lucid.plugin.registerProperty(b,
"CellFill_"+d,a.DEFAULTFILL);void 0===lucid.plugin.getProperty(b,"NoBand_"+d)&&lucid.plugin.registerProperty(b,"NoBand_"+d,!1);e=lucid.plugin.getProperty(b,"CellSize_"+d);void 0===e&&(e={w:1,h:1});lucid.plugin.registerProperty(b,"CellSize_"+d,e,function(b){b.w=Math.max(1,b.w);b.h=Math.max(1,b.h);return b})};
u.common.Table.registerCommonProperties=function(a,b){function e(a,c){for(a=lucid.plugin.getProperty(b,a);a.length<c;)a.push(a[a.length-1]);a.splice(c);return a}lucid.plugin.registerProperty(b,"HideH",!1);lucid.plugin.registerProperty(b,"HideV",!1);lucid.plugin.registerProperty(b,"TableGridLineColorH",void 0);lucid.plugin.registerProperty(b,"TableGridLineColorV",void 0);lucid.plugin.registerProperty(b,"TableGridLineWidthH",void 0);lucid.plugin.registerProperty(b,"TableGridLineWidthV",void 0);lucid.plugin.registerProperty(b,
"TableGridStrokeStyleH",void 0);lucid.plugin.registerProperty(b,"TableGridStrokeStyleV",void 0);lucid.plugin.registerProperty(b,"RowHeights",Array.apply(null,{length:a.INITROWS}).map(function(){return a.INITROWHEIGHT}),null,function(a,c){if(lucid.plugin.isPermanentObject(b)){for(var e=a=0;e<c.length;e++)a+=c[e];c=lucid.plugin.getProperty(b,"BoundingBox");Math.round(c.h)!=Math.round(a)&&(c.h=Math.round(a),lucid.plugin.setPropertyIfChanged(b,"BoundingBox",c))}});lucid.plugin.registerProperty(b,"ColWidths",
Array.apply(null,{length:a.INITCOLS}).map(function(){return a.INITCOLWIDTH}),null,function(a,c){if(lucid.plugin.isPermanentObject(b)){for(var e=a=0;e<c.length;e++)a+=c[e];c=lucid.plugin.getProperty(b,"BoundingBox");Math.round(c.w)!=Math.round(a)&&(c.w=Math.round(a),lucid.plugin.setPropertyIfChanged(b,"BoundingBox",c))}});lucid.plugin.registerProperty(b,"Rows",a.INITROWS,null,function(c,d){if(lucid.plugin.isPermanentObject(b)&&c!=d){c<=d?lucid.plugin.tagExecution("plugin-table-add-row"):lucid.plugin.tagExecution("plugin-table-remove-row");
for(var l=lucid.plugin.getProperty(b,"Cols"),h=0;h<d;h++)for(var g=0;g<l;g++)u.common.Table.createCell(a,b,h,g);h=e("RowHeights",d);lucid.plugin.setPropertyIfChanged(b,"RowHeights",h);lucid.plugin.setMinHeight(b,d*a.MINROWHEIGHT);for(h=c;h<d;h++)for(g=0;g<l;g++){var k=h+","+g,p=c-1+","+g;lucid.plugin.setPropertyIfChanged(b,"CellFill_"+k,lucid.plugin.getProperty(b,"CellFill_"+p));lucid.plugin.setPropertyIfChanged(b,"NoBand_"+k,lucid.plugin.getProperty(b,"NoBand_"+p))}lucid.object.forEach(u.common.Table.getVisibleCells(b),
function(a){a.row+a.size.h>d&&lucid.plugin.setPropertyIfChanged(b,"CellSize_"+a.row+","+a.col,{w:a.size.w,h:Math.max(1,d-a.row)})})}});lucid.plugin.setMinHeight(b,a.INITROWS*a.MINROWHEIGHT);lucid.plugin.registerProperty(b,"Cols",a.INITCOLS,null,function(c,d){if(lucid.plugin.isPermanentObject(b)&&c!=d){for(var g=lucid.plugin.getProperty(b,"Rows"),h=0;h<g;h++)for(var k=0;k<d;k++)u.common.Table.createCell(a,b,h,k);var n=lucid.plugin.getProperty(b,"BoundingBox");h=e("ColWidths",d);var p=0;for(k=0;k<h.length;k++)p+=
h[k];n=n.w/p;for(k=0;k<h.length;k++)h[k]=Math.max(h[k]*n,a.MINCOLWIDTH);lucid.plugin.setPropertyIfChanged(b,"ColWidths",h);lucid.plugin.setMinWidth(b,d*a.MINCOLWIDTH);for(h=0;h<g;h++)for(k=c;k<d;k++)n=h+","+k,p=h+","+(c-1),lucid.plugin.setPropertyIfChanged(b,"CellFill_"+n,lucid.plugin.getProperty(b,"CellFill_"+p)),lucid.plugin.setPropertyIfChanged(b,"NoBand_"+n,lucid.plugin.getProperty(b,"NoBand_"+p));lucid.object.forEach(u.common.Table.getVisibleCells(b),function(a){a.col+a.size.w>d&&lucid.plugin.setPropertyIfChanged(b,
"CellSize_"+a.row+","+a.col,{w:Math.max(1,d-a.col),h:a.size.h})})}});lucid.plugin.setMinWidth(b,a.INITCOLS*a.MINCOLWIDTH);lucid.plugin.setProperty(b,"InsetMargin",5);lucid.plugin.setProperty(b,"SelectedAnchor",{row:0,col:0},!0);lucid.plugin.setProperty(b,"SelectedCursor",{row:0,col:0},!0);lucid.plugin.setProperty(b,"SelectedCells",{},!0);lucid.plugin.registerProperty(b,"BandedRows",!1);lucid.plugin.registerProperty(b,"BandedCols",!1);lucid.plugin.registerProperty(b,"BandedColor1",a.BANDEDCOLOR1);
lucid.plugin.registerProperty(b,"BandedColor2","#ffffff");lucid.plugin.registerProxyProperty(b,"FillColor",function(){var a=lucid.plugin.getProperty(b,"Rows"),c=lucid.plugin.getProperty(b,"Cols");if(a&&c){for(var d=lucid.plugin.getProperty(b,"SelectedCells",!0),h=0<Object.keys(d).length,e=lucid.plugin.getProperty(b,"BandedRows"),n=lucid.plugin.getProperty(b,"BandedCols"),p=lucid.plugin.getProperty(b,"BandedColor1"),r=lucid.plugin.getProperty(b,"BandedColor2"),q=void 0,t=0;t<a;t++)for(var w=0;w<c;w++){var x=
t+","+w;if(!h||d[x]){var y=lucid.plugin.getProperty(b,"CellFill_"+x);if(!lucid.plugin.getProperty(b,"NoBand_"+x))if(e&&0==t%2||n&&0==w%2)y=p;else if(e&&1==t%2||n&&1==w%2)y=r;if(void 0===q)q=y;else if(!lucid.object.areEqual(q,y))return null}}return q}},function(c){if(a.ALLOWOBJECTFILL||!lucid.object.isObject(c)){var d=lucid.plugin.getProperty(b,"Rows"),e=lucid.plugin.getProperty(b,"Cols"),h=lucid.plugin.getProperty(b,"BandedRows"),g=lucid.plugin.getProperty(b,"BandedCols"),n=lucid.plugin.getProperty(b,
"SelectedCells",!0),p=0<Object.keys(n).length;p||!h&&!g||(lucid.plugin.setPropertyIfChanged(b,"BandedRows",!1),lucid.plugin.setPropertyIfChanged(b,"BandedCols",!1));for(var r=0;r<d;r++)for(var q=0;q<e;q++){var t=r+","+q;if(!p||n[t])lucid.plugin.setPropertyIfChanged(b,"CellFill_"+t,c),p&&(h||g)&&lucid.plugin.setPropertyIfChanged(b,"NoBand_"+t,!0)}}});lucid.plugin.hookPropertyPostSave(b,null,function(a,c,d){"Rows"!==d&&"Cols"!==d&&"RowHeights"!==d&&"ColWidths"!==d&&"BoundingBox"!==d&&0!==d.indexOf("CellSize")||
u.common.Table.clearCellCache(b)});lucid.plugin.hookPropertyPostSave(b,null,function(a,c,d){"Rows"!=d&&"Cols"!=d&&"BandedRows"!=d&&"BandedCols"!=d&&"BandedColor1"!=d&&"BandedColor2"!=d&&0!=d.indexOf("CellFill")&&0!=d.indexOf("NoBand")||lucid.plugin.proxyPropertyChanged(b,"FillColor")});for(var c=0;c<a.INITROWS;c++)for(var d=0;d<a.INITCOLS;d++)u.common.Table.createCell(a,b,c,d)};
u.common.Table.getCursor=function(a,b){var e="n ne e se s sw w nw".split(" ");a=e.indexOf(a);0!=b&&(a=(a+Math.round(180*b/Math.PI/45))%e.length);return"url("+lucid.config.assets_base_url+"/app/webroot/img/cursors/"+e[a]+"-resize.png) 16 16, auto"};u.common.Table.selectCell=function(a,b,e,c,d,g,k){if(e[d+","+g])for(b=lucid.plugin.getProperty(b,"CellSize_"+d+","+g),e=0;e<b.h;e++)for(var l=0;l<b.w;l++){var h=d+e+","+(g+l);c[h]=k?!c[h]:!0}a.FIRESELECTIONCHANGED&&lucidAPI.plugin.fireSelectionChanged()};
u.common.Table.getOffsetProperties=function(a,b,e,c,d,g,k,l,h){function v(a,b,c){var h=a.w,d=a.h;a.w=lucid.array.reduce(b,function(a,b){return a+b},0);a.h=lucid.array.reduce(c,function(a,b){return a+b},0);Math.round(a.w)==Math.round(q.w)&&Math.round(h)==Math.round(a.w)||q.x==a.x||(a.x=q.x+(q.w-a.w));Math.round(a.h)==Math.round(q.h)&&Math.round(d)==Math.round(a.h)||q.y==a.y||(a.y=q.y+(q.h-a.h));return a}function n(a,b,c,h){var d=[];a.map(function(a,b){return{size:a,index:b}}).sort(function(a,b){return a.size-
b.size}).reduce(function(a,c){var h=Math.max(b,a.target/a.current*c.size);d[c.index]=h;return{current:a.current-c.size,target:a.target-h}},{current:h,target:c});return d}function p(c){return n(lucid.plugin.getProperty(b,"ColWidths"),a.MINCOLWIDTH,c.w,q.w)}function r(c){return n(lucid.plugin.getProperty(b,"RowHeights"),a.MINROWHEIGHT,c.h,q.h)}var q=lucid.plugin.getProperty(b,"BoundingBox"),t=lucid.plugin.getProperty(b,"AspectRatio"),w=lucid.plugin.getProperty(b,"Cols")*a.MINCOLWIDTH,x=lucid.plugin.getProperty(b,
"Rows")*a.MINROWHEIGHT;c=lucid.plugin.defaultOffsetProperties(b,e,c,d,g,k,l,h);e={};c[b]&&c[b].BoundingBox&&(c=c[b].BoundingBox,t&&(c.w<w&&(c.w=w,c.h=w/t),c.h<x&&(c.h=x,c.w=t*x)),t=p(c),w=r(c),c=v(c,t,w),e[b]={BoundingBox:c,ColWidths:t,RowHeights:w});return e};
u.common.Table.getSelectionFromAnchor=function(a,b,e){var c=lucid.plugin.getProperty(b,"SelectedAnchor",!0),d=lucid.plugin.getProperty(b,"SelectedCursor",!0),g={},k=lucid.plugin.getProperty(b,"CellSize_"+c.row+","+c.col),l=lucid.plugin.getProperty(b,"CellSize_"+d.row+","+d.col),h=lucid.math.Box.from4Points({x:c.row,y:c.col},{x:c.row+k.h-1,y:c.col+k.w-1},{x:d.row,y:d.col},{x:d.row+l.h-1,y:d.col+l.w-1});lucid.object.forEach(e,function(c){lucid.math.Box.overlap(h,{x:c.row,y:c.col,w:c.size.h-1,h:c.size.w-
1})&&u.common.Table.selectCell(a,b,e,g,c.row,c.col)});return g};
u.common.Table.hitTest=function(a,b,e){function c(a,b,c){for(var h=0;h<a.length;h++){if(c>b&&c<=b+a[h])return h;b+=a[h]}}var d=lucid.plugin.getSelection();if(!(1<d.length||lucid.plugin.getProperty(b,"Lock")||u.common.Table.isRestricted(b)||1==d.length&&d[0]!=b&&e.shift)){var g=lucid.plugin.getProperty(b,"BoundingBox");if(g){var k=lucid.plugin.getProperty(b,"Rotation"),l=lucid.math.Point.rotate(e,lucid.math.Box.center(g),-k);if(lucid.math.Box.pointInBox(l,{x:g.x-20,y:g.y-20,h:g.h+20,w:g.w+20})){var h=
lucid.plugin.getProperty(b,"ColWidths"),v=lucid.plugin.getProperty(b,"RowHeights"),n=u.common.Table.getVisibleCells(b);if(lucid.math.Box.pointInBox(l,g)){var p=lucid.math.Point.subtract(l,g),r=lucid.object.findValue(n,function(a){return lucid.math.Box.pointInBox(p,a)});if(-1<d.indexOf(b)){d=g.x;for(k=0;k<h.length;k++)if(d+=h[k],l.x>d-5&&l.x<d+5)return;d=g.y;for(k=0;k<v.length;k++)if(d+=v[k],l.y>d-5&&l.y<d+5)return;return{onClick:function(){var c=lucid.plugin.getProperty(b,"SelectedCells",!0);if(!e.shift){if(e.ctrl){u.common.Table.selectCell(a,
b,n,c,r.row,r.col,!0);u.common.Table.setSelection(a,b,c);return}var h=lucid.plugin.getProperty(b,"SelectedAnchor",!0),d=lucid.plugin.getProperty(b,"SelectedCursor",!0);if(h.row==d.row&&h.col==d.col&&h.row==r.row&&h.col==r.col){h=c[r.row+","+r.col];c=u.common.Table.getSelectionFromAnchor(a,b,n);h&&u.common.Table.selectCell(a,b,n,c,r.row,r.col,!0);u.common.Table.setSelection(a,b,c);return}lucid.plugin.setProperty(b,"SelectedAnchor",{row:r.row,col:r.col},!0)}lucid.plugin.setProperty(b,"SelectedCursor",
{row:r.row,col:r.col},!0);c=u.common.Table.getSelectionFromAnchor(a,b,n);u.common.Table.setSelection(a,b,c)},onDoubleClick:function(){u.common.Table.setSelection(a,b,{});lucid.text.focusEditor(b,"Cell_"+r.row+","+r.col)},cursor:"pointer",allowCtrl:!0}}}if(l.x>g.x+a.SELECTOFFSET&&l.y<g.y&&-1<d.indexOf(b))return{onClick:function(){var d=c(h,g.x,l.x);var k=e.shift||e.ctrl?lucid.plugin.getProperty(b,"SelectedCells",!0):{};for(var r=0;r<v.length;r++)u.common.Table.selectCell(a,b,n,k,r,d);u.common.Table.setSelection(a,
b,k)},cursor:u.common.Table.getCursor("s",k),allowCtrl:!0,allowSelection:!0};if(l.y>g.y+a.SELECTOFFSET&&l.x<g.x&&-1<lucid.plugin.getSelection().indexOf(b))return{onClick:function(){var d=c(v,g.y,l.y);var k=e.shift||e.ctrl?lucid.plugin.getProperty(b,"SelectedCells",!0):{};for(var r=0;r<h.length;r++)u.common.Table.selectCell(a,b,n,k,d,r);u.common.Table.setSelection(a,b,k)},cursor:u.common.Table.getCursor("e",k),allowCtrl:!0,allowSelection:!0}}}}};
u.common.Table.getRenderData=function(a,b,e){var c=b.BoundingBox,d=u.common.Table.getVisibleCells(b.id,b);u.common.Table.updateTextAreaIndexes(b.id,d);if("sample"==e||"preview"==e){var g=b.ColWidths.reduce(function(a,b){return a+b},0),k=b.RowHeights.reduce(function(a,b){return a+b},0);d=lucid.object.map(d,function(a){a.w*=c.w/g;a.x*=c.w/g;a.y*=c.h/k;a.h*=c.h/k;return a})}var l=[];lucid.object.forEach(d,function(a){var d=a.row+","+a.col,h=b["CellFill_"+d];if(!b["NoBand_"+d])if(b.BandedRows&&0==a.row%
2||b.BandedCols&&0==a.col%2)h=b.BandedColor1;else if(b.BandedRows&&1==a.row%2||b.BandedCols&&1==a.col%2)h=b.BandedColor2;l.push({StrokeColor:null,LineWidth:null,NoRounding:!0,FillColor:h,Actions:[{Action:"move",x:c.x+a.x,y:c.y+a.y},{Action:"line",x:c.x+a.x+a.w,y:c.y+a.y},{Action:"line",x:c.x+a.x+a.w,y:c.y+a.y+a.h},{Action:"line",x:c.x+a.x,y:c.y+a.y+a.h},{Action:"close"}]})});b.HideH||lucid.object.forEach(d,function(a){var d={StrokeColor:b.TableGridLineColorH?b.TableGridLineColorH:b.LineColor,LineWidth:b.TableGridLineWidthH?
b.TableGridLineWidthH:b.LineWidth,StrokeStyle:b.TableGridStrokeStyleH?b.TableGridStrokeStyleH:b.StrokeStyle,NoRounding:!0};d.Actions=0<a.row&&a.row+1<b.Rows?[{Action:"move",x:c.x+a.x,y:c.y+a.y},{Action:"line",x:c.x+a.x+a.w,y:c.y+a.y},{Action:"move",x:c.x+a.x,y:c.y+a.y+a.h},{Action:"line",x:c.x+a.x+a.w,y:c.y+a.y+a.h}]:0<a.row?[{Action:"move",x:c.x+a.x,y:c.y+a.y},{Action:"line",x:c.x+a.x+a.w,y:c.y+a.y}]:[{Action:"move",x:c.x+a.x,y:c.y+a.y+a.h},{Action:"line",x:c.x+a.x+a.w,y:c.y+a.y+a.h}];l.push(d)});
b.HideV||lucid.object.forEach(d,function(a){var d={StrokeColor:b.TableGridLineColorV?b.TableGridLineColorV:b.LineColor,LineWidth:b.TableGridLineWidthV?b.TableGridLineWidthV:b.LineWidth,StrokeStyle:b.TableGridStrokeStyleV?b.TableGridStrokeStyleV:b.StrokeStyle,NoRounding:!0};d.Actions=0<a.col&&a.col+1<b.Cols?[{Action:"move",x:c.x+a.x,y:c.y+a.y},{Action:"line",x:c.x+a.x,y:c.y+a.y+a.h},{Action:"move",x:c.x+a.x+a.w,y:c.y+a.y},{Action:"line",x:c.x+a.x+a.w,y:c.y+a.y+a.h}]:0<a.col?[{Action:"move",x:c.x+a.x,
y:c.y+a.y},{Action:"line",x:c.x+a.x,y:c.y+a.y+a.h}]:[{Action:"move",x:c.x+a.x+a.w,y:c.y+a.y},{Action:"line",x:c.x+a.x+a.w,y:c.y+a.y+a.h}];l.push(d)});l.push({StrokeColor:b.LineColor,LineWidth:b.LineWidth,StrokeStyle:b.StrokeStyle,FillColor:null,NoRounding:!0,Actions:[{Action:"move",x:c.x,y:c.y},{Action:"line",x:c.x+c.w,y:c.y},{Action:"line",x:c.x+c.w,y:c.y+c.h},{Action:"line",x:c.x,y:c.y+c.h},{Action:"close"}]});"pdf"!=e&&lucid.object.forEach(d,function(d){b.SelectedCells[d.row+","+d.col]&&(l.push({StrokeColor:"#ffffff",
LineWidth:a.SELECTEDLINEWIDTH,NoRounding:!0,Actions:[{Action:"move",x:c.x+d.x+a.SELECTEDLINEWIDTH,y:c.y+d.y+a.SELECTEDLINEWIDTH},{Action:"line",x:c.x+d.x+d.w-a.SELECTEDLINEWIDTH,y:c.y+d.y+a.SELECTEDLINEWIDTH},{Action:"line",x:c.x+d.x+d.w-a.SELECTEDLINEWIDTH,y:c.y+d.y+d.h-a.SELECTEDLINEWIDTH},{Action:"line",x:c.x+d.x+a.SELECTEDLINEWIDTH,y:c.y+d.y+d.h-a.SELECTEDLINEWIDTH},{Action:"close"}]}),l.push(lucid.math.dashLine([{StrokeColor:"#29aae1",LineWidth:a.SELECTEDLINEWIDTH-1,NoRounding:!0,Actions:[{Action:"move",
x:c.x+d.x+a.SELECTEDLINEWIDTH,y:c.y+d.y+a.SELECTEDLINEWIDTH},{Action:"line",x:c.x+d.x+d.w-a.SELECTEDLINEWIDTH,y:c.y+d.y+a.SELECTEDLINEWIDTH},{Action:"line",x:c.x+d.x+d.w-a.SELECTEDLINEWIDTH,y:c.y+d.y+d.h-a.SELECTEDLINEWIDTH},{Action:"line",x:c.x+d.x+a.SELECTEDLINEWIDTH,y:c.y+d.y+d.h-a.SELECTEDLINEWIDTH},{Action:"close"}]}],[5,5])[1]))});return l};u.common.Table.getFirstCell=function(a){a=a.slice().sort(u.common.Table.cellComparator);return a[0]};
u.common.Table.getSelectedCells=function(a){a=lucid.plugin.getProperty(a,"SelectedCells",!0);return lucid.object.getKeys(lucid.object.filter(a,function(a){return a}))};u.common.Table.cellComparator=function(a,b){return a.row-b.row||a.col-b.col};u.common.Table.keyToCoordinates=function(a){a=a.split(",");return{row:+a[0],col:+a[1]}};u.common.Table.isRestricted=function(a){return 1==lucid.plugin.getProperty(a,"Restrictions",!1).b};
u.common.Table.getSelectedTable=function(a){var b=lucid.plugin.getSelection();return 1==b.length&&lucid.plugin.getBlockClassName(b[0])===a.BLOCKNAME?b[0]:null};
u.common.Table.beforePaste=function(a,b){var e;if(!b.getLucidObjects()&&!b.getLucidPanels()&&(e=u.common.Table.getSelectedTable(a))){if(u.common.Table.isRestricted(e))return!1;var c,d,g=u.common.Table.getSelectedCells(e);g=g.length?u.common.Table.getFirstCell(g.map(u.common.Table.keyToCoordinates)):{row:0,col:0};if((c=b.getMixed())&&(d=c.getTables()).length)if(1===d.length){var k=d[0].cells;var l=d[0].fills}else return d.forEach(function(b){u.common.Table.create(a,b)}),!0;else if(c=b.getLucidText())k=
m.CopyPasteUtils.tableSplit(c);else if(b=b.getText())k=b.split(/\r?\n/).map(function(a){return a.split("\t")});if(k)return u.common.Table.pasteCells(a,e,g.row,g.col,k,l),!0}return!1};
u.common.Table.beforeCopyCut=function(a,b){var e=u.common.Table.getSelectedTable(b);if(!e||u.common.Table.isRestricted(e)||!u.common.Table.getPackedSelectionBounds(e)&&u.common.Table.getSelectedCells(e).length)return!1;for(var c=lucid.plugin.getProperty(e,"Rows"),d=lucid.plugin.getProperty(e,"Cols"),g=[],k=[],l=0;l<c;l++){g.push([]);k.push([]);for(var h=0;h<d;h++)g[l].push({m:[],t:""}),k[l].push("#ffffff00")}b=u.common.Table.getSelectedCells(e).map(u.common.Table.keyToCoordinates);var v=b.length;
if(!v)for(l=0;l<c;l++)for(h=0;h<d;h++)b.push({row:l,col:h});b.forEach(function(a){g[a.row][a.col]=lucid.plugin.getProperty(e,"Cell_"+a.row+","+a.col);k[a.row][a.col]=lucid.plugin.getProperty(e,"CellFill_"+a.row+","+a.col)});if(v){var n=c,p=-1,r=d,q=-1;b.forEach(function(a){n=Math.min(n,a.row);p=Math.max(p,a.row+1);r=Math.min(r,a.col);q=Math.max(q,a.col+1)});c=g.slice(n,p).map(function(a){return a.slice(r,q)});d=k.slice(n,p).map(function(a){return a.slice(r,q)})}else c=g,d=k;d={borderColor:lucid.plugin.getProperty(e,
"LineColor"),borderThickness:lucid.plugin.getProperty(e,"LineWidth"),cells:c,columnSizes:lucid.plugin.getProperty(e,"ColWidths"),fills:d,rowSizes:lucid.plugin.getProperty(e,"RowHeights")};if(v)return"cut"===a&&b.forEach(function(a){lucid.plugin.setPropertyIfChanged(e,"Cell_"+a.row+","+a.col,"")}),a=c.map(function(a){return a.map(function(a){return lucid.text.plainText(a).replace(/[\t\n]/g," ")}).join("\t")}).join("\n"),{mixed:[{type:"table",value:d}],text:a};"cut"===a&&lucid.plugin.deleteItem(e);
return{lucidTable:{lucidObjects:lucid.clipboard.getClipboardData([e]),table:d}}};
u.common.Table.deleteSelection=function(a,b,e){if(null==b){var c=lucid.plugin.getSelection();if(1!=c.length||lucid.plugin.getBlockClassName(c[0])!=a.BLOCKNAME)return!0;b=c[0]}c=lucid.plugin.getProperty(b,"SelectedCells",!0);if(!e){var d=!1;for(var g in c)c[g]&&(lucid.plugin.setPropertyIfChanged(b,"Cell_"+g,""),d=!0);return d?(u.common.Table.setSelection(a,b,{}),!1):!0}g=lucid.plugin.getProperty(b,"Rows");e=lucid.plugin.getProperty(b,"Cols");for(var k,l=0;l<g;l++)for(var h=0;h<e;h++)if(c[l+","+h]){k||
(k={row:l,col:h});var v=l;d=h}if(!k)return!0;if(0==k.row&&v==g-1){var n=[],p=!0;for(h=0;h<e;h++)if(c["0,"+h])for(n.push(h),l=k.row;l<=v;l++)c[l+","+h]||(p=!1);else for(l=0;l<g;l++)if(c[l+","+h])return!0;if(p&&n.length!=e)return n.reverse(),lucid.array.forEach(n,function(a){u.common.Table.deleteColumn(b,lucid.plugin.getAllProperties(b),a)}),u.common.Table.setSelection(a,b,{}),!1}if(0==k.col&&d==e-1){v=[];n=!0;for(l=0;l<g;l++)if(c[l+",0"])for(v.push(i),h=k.col;h<=d;h++)c[l+","+h]||(n=!1);else for(h=
0;h<e;h++)if(c[l+","+h])return!0;if(n&&v.length!=g)return v.reverse(),lucid.array.forEach(v,function(a){u.common.Table.deleteRow(b,lucid.plugin.getAllProperties(b),a)}),u.common.Table.setSelection(a,b,{}),!1}return!0};u.table={};var B={BLOCKNAME:"DefaultTableBlock",MINCOLWIDTH:30,MINROWHEIGHT:20,MAXROWS:60,MAXCOLS:30,INITCOLS:3,INITROWS:3,INITCOLWIDTH:80,INITROWHEIGHT:40,SELECTEDLINEWIDTH:3,SELECTONFOCUS:!0,FILTERTEXTONSELECT:!0,ALLOWOBJECTFILL:!0,CLEARDELETEDCELLS:!0,FIRESELECTIONCHANGED:!1,BANDEDCOLOR1:"#99ccff",DEFAULTFILL:"#ffffff"};
function C(){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){var b=u.common.Table.getVisibleSelectedCells(a),c=null;lucid.object.forEach(b,function(a){null==c?c=a:a.col<c.col&&(c=a)});u.common.Table.addColumn(B,a,lucid.plugin.getAllProperties(a),c,!0)})}
function D(){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){var b=u.common.Table.getVisibleSelectedCells(a),c=null;lucid.object.forEach(b,function(a){null==c?c=a:a.col+a.size.w>c.col+c.size.w&&(c=a)});u.common.Table.addColumn(B,a,lucid.plugin.getAllProperties(a),c,!1)})}function E(){var a=u.common.Table.getSelectedTables(B);return lucid.array.every(a,function(a){return lucid.plugin.getProperty(a,"Cols")>=B.MAXCOLS})}
function F(){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){var b=u.common.Table.getVisibleSelectedCells(a),c=null;lucid.object.forEach(b,function(a){null==c?c=a:a.row<c.row&&(c=a)});u.common.Table.addRow(B,a,lucid.plugin.getAllProperties(a),c,!0)})}
function G(){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){var b=u.common.Table.getVisibleSelectedCells(a),c=null;lucid.object.forEach(b,function(a){null==c?c=a:a.row+a.size.h>c.row+c.size.h&&(c=a)});u.common.Table.addRow(B,a,lucid.plugin.getAllProperties(a),c,!1)})}function H(){var a=u.common.Table.getSelectedTables(B);return lucid.array.every(a,function(a){return lucid.plugin.getProperty(a,"Rows")>=B.MAXROWS})}
function I(){if(u.common.Table.canDeleteRow(B)){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){var b=lucid.object.getValues(u.common.Table.getVisibleSelectedCells(a));u.common.Table.deleteRow(B,a,lucid.plugin.getAllProperties(a),b[0].row);u.common.Table.setSelection(B,a,{})})}}
function J(){if(u.common.Table.canDeleteColumn(B)){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){var b=lucid.object.getValues(u.common.Table.getVisibleSelectedCells(a));u.common.Table.deleteColumn(B,a,lucid.plugin.getAllProperties(a),b[0].col);u.common.Table.setSelection(B,a,{})})}}function K(){if(!L()){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){u.common.Table.mergeCells(a)})}}
function L(){var a=u.common.Table.getSelectedTables(B);return!lucid.array.every(a,function(a){return u.common.Table.canMergeCells(a)})}function M(){if(!N()){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){u.common.Table.unMergeCells(a)})}}function N(){var a=u.common.Table.getSelectedTables(B);return!lucid.array.every(a,function(a){return u.common.Table.hasMergedCellsSelected(a)})}
if(!lucid.newEditor)lucid.plugin.onDocumentLoaded(function(){function a(a,b){a=lucid.array.filter(a,function(a){return lucid.plugin.getBlockClassName(a)==B.BLOCKNAME});var c=lucid.plugin.getProperty(a[0],b);lucid.array.forEach(a,function(a){lucid.plugin.getProperty(a,b)!=c&&(c=" ")});return c}function b(a){return function(b,c){c||(c=u.common.Table.getSelectedTables(B),lucid.array.forEach(c,function(c){lucid.plugin.setProperty(c,a,b)}))}}function e(a){return function(b,c){c||(c=u.common.Table.getSelectedTables(B),
lucid.array.forEach(c,function(c){lucid.plugin.setProperty(c,a,b);if(!lucid.plugin.getProperty(c,"BandedRows")&&!lucid.plugin.getProperty(c,"BandedCols")){var d=lucid.object.filter(lucid.plugin.getAllProperties(c),function(a,b){return-1<b.indexOf("NoBand")}),e;for(e in d)lucid.plugin.setPropertyIfChanged(c,e,!1)}}))}}var c=lucid.template.builder();c.addGrid({width:5,content:{text:i18n.get("plugin-table-menu-rows"),classes:"crop ralign"}});c.openGrid({width:3});c.addInput({type:"spinner",min:1,max:B.MAXROWS,
step:1,value:B.INITROWS,defaultVal:" ",onChange:b("Rows"),checkUpdate:function(b){return{value:a(b,"Rows")}}});c.close();c.clear();c.spacer();c.addGrid({width:5,content:{text:i18n.get("plugin-table-menu-cols"),classes:"crop ralign"}});c.openGrid({width:3});c.addInput({type:"spinner",min:1,max:B.MAXCOLS,step:1,value:3,defaultVal:" ",onChange:b("Cols"),checkUpdate:function(b){return{value:a(b,"Cols")}}});c.close();c.clear();c.spacer();c.addGrid({width:5,content:{text:i18n.get("plugin-table-menu-insert"),
classes:"crop ralign"}});c.openGrid({width:6});c.addInput({type:"buttonset",checkUpdate:function(){this.input.refresh()},buttons:[{icon:"add-col-left",action:C,disabled:E,logAction:"plugin.tables.contextPanel.add.col.left",tooltip:i18n.get("plugin-table-menu-add-col-left")},{icon:"add-col-right",action:D,disabled:E,logAction:"plugin.tables.contextPanel.add.col.right",tooltip:i18n.get("plugin-table-menu-add-col-right")},{icon:"add-row-top",action:F,disabled:H,logAction:"plugin.tables.contextPanel.add.row.above",
tooltip:i18n.get("plugin-table-menu-add-row-above")},{icon:"add-row-bottom",action:G,disabled:H,logAction:"plugin.tables.contextPanel.add.row.below",tooltip:i18n.get("plugin-table-menu-add-row-below")}]});c.close();c.clear();c.spacer();c.addGrid({width:5,content:{text:i18n.get("plugin-table-menu-delete"),classes:"crop ralign"}});c.openGrid({width:6});c.addInput({type:"buttonset",checkUpdate:function(){this.input.refresh()},buttons:[{icon:"del-col",action:J,disabled:function(){return!u.common.Table.canDeleteColumn(B)},
logAction:"plugin.tables.contextPanel.delete.col",tooltip:i18n.get("plugin-table-menu-delete-column")},{icon:"del-row",action:I,disabled:function(){return!u.common.Table.canDeleteRow(B)},logAction:"plugin.tables.contextPanel.delete.row",tooltip:i18n.get("plugin-table-menu-delete-row")}]});c.close();c.clear();c.spacer();c.addGrid({width:5,content:{text:i18n.get("plugin-table-menu-banded"),classes:"crop ralign"}});c.openGrid({width:1});c.addInput({type:"checkbox",defaultVal:!1,onChange:e("BandedRows"),
checkUpdate:function(b){return{value:a(b,"BandedRows")}},logAction:"plugin.tables.contextPanel.banded.rows"});c.close();c.addGrid({width:2,content:{text:i18n.get("plugin-table-menu-banded-rows")}});c.openGrid({width:1});c.addInput({type:"checkbox",defaultVal:!1,onChange:e("BandedCols"),checkUpdate:function(b){return{value:a(b,"BandedCols")}},logAction:"plugin.tables.contextPanel.banded.cols"});c.close();c.addGrid({width:3,content:{text:i18n.get("plugin-table-menu-banded-cols")}});c.clear();c.spacer();
c.addGrid({width:5,content:{text:i18n.get("plugin-table-menu-banded-colors"),classes:"crop ralign"}});c.openGrid({width:2});c.addInput({type:"colorwell",value:null,checkUpdate:function(b){return{value:a(b,"BandedColor1")}},onChange:b("BandedColor1")});c.close();c.openGrid({width:2});c.addInput({type:"colorwell",value:null,checkUpdate:function(b){return{value:a(b,"BandedColor2")}},onChange:b("BandedColor2")});c.close();c.clear();c.spacer();c.addGrid({width:5,content:{text:i18n.get("plugin-table-menu-grid-type"),
classes:"crop ralign"}});c.openGrid({width:6});c.addInput({type:"buttonset",checkUpdate:function(){this.input.refresh()},buttons:[{icon:"table-grid-full",action:function(){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){lucid.plugin.setPropertyIfChanged(a,"HideH",!1);lucid.plugin.setPropertyIfChanged(a,"HideV",!1)})},tooltip:i18n.get("plugin-table-menu-grid-full"),logAction:"plugin.tables.contextPanel.grid.full",selected:function(){for(var a=u.common.Table.getSelectedTables(B),
b=0;b<a.length;b++)if(lucid.plugin.getProperty(a[b],"HideH")||lucid.plugin.getProperty(a[b],"HideV"))return!1;return!0}},{icon:"table-grid-col",action:function(){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){lucid.plugin.setPropertyIfChanged(a,"HideH",!0);lucid.plugin.setPropertyIfChanged(a,"HideV",!1)})},tooltip:i18n.get("plugin-table-menu-grid-columns"),logAction:"plugin.tables.contextPanel.grid.columns",selected:function(){for(var a=u.common.Table.getSelectedTables(B),
b=0;b<a.length;b++)if(!lucid.plugin.getProperty(a[b],"HideH")||lucid.plugin.getProperty(a[b],"HideV"))return!1;return!0}},{icon:"table-grid-row",action:function(){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){lucid.plugin.setPropertyIfChanged(a,"HideH",!1);lucid.plugin.setPropertyIfChanged(a,"HideV",!0)})},tooltip:i18n.get("plugin-table-menu-grid-rows"),logAction:"plugin.tables.contextPanel.grid.rows",selected:function(){for(var a=u.common.Table.getSelectedTables(B),
b=0;b<a.length;b++)if(lucid.plugin.getProperty(a[b],"HideH")||!lucid.plugin.getProperty(a[b],"HideV"))return!1;return!0}},{icon:"table-grid-empty",action:function(){var a=u.common.Table.getSelectedTables(B);lucid.array.forEach(a,function(a){lucid.plugin.setPropertyIfChanged(a,"HideH",!0);lucid.plugin.setPropertyIfChanged(a,"HideV",!0)})},tooltip:i18n.get("plugin-table-menu-grid-empty"),logAction:"plugin.tables.contextPanel.grid.empty",selected:function(){for(var a=u.common.Table.getSelectedTables(B),
b=0;b<a.length;b++)if(!lucid.plugin.getProperty(a[b],"HideH")||!lucid.plugin.getProperty(a[b],"HideV"))return!1;return!0}}]});c.close();c.clear();c.spacer();c.addGrid({width:5,content:{text:i18n.get("plugin-table-menu-merge"),classes:"crop ralign"}});c.openGrid({width:6});c.addInput({type:"buttonset",checkUpdate:function(){this.input.refresh()},buttons:[{icon:"table-merge",logAction:"plugin.tables.contextPanel.merge",wide:!0,action:K,disabled:L,tooltip:i18n.get("plugin-table-menu-merge-cells")},{icon:"table-unmerge",
logAction:"plugin.tables.contextPanel.unmerge",wide:!0,action:M,disabled:N,tooltip:i18n.get("plugin-table-menu-unmerge-cells")}]});c.close();c.clear();c.spacer();c.addGrid({width:12,content:{text:i18n.get("plugin-table-menu-select-multiple-cells-hint"),classes:"center italic",css:{color:"#666"}}});lucid.plugin.addCustomPanel("",null,[{content:c}],null,{isContextPanel:!0,checkShow:function(a){a=lucid.array.filter(a,function(a){return a.isBlock});if(!lucid.array.every(a,function(a){return-1<a.className.search(B.BLOCKNAME)}))return!1;
c.refreshInputs();return 0<a.length},refreshProperties:"Rows Cols BandedColor1 BandedColor2 HideV HideH BandedRows BandedCols".split(" ")})});B.POSTSELECT=lucid.plugin.refreshBlockView;lucid.clipboard.beforeCopy(u.common.Table.beforeCopyCut.bind(null,"copy",B));lucid.clipboard.beforeCut(u.common.Table.beforeCopyCut.bind(null,"cut",B));
lucid.plugin.initBlockClass({className:B.BLOCKNAME,name:i18n.get("plugin-table-shape-name-table"),searchKeywords:i18n.get("plugin-table-search-keywords"),defaultSize:{w:240,h:120},rLock:!0,unthemed:!0,defaultProperties:function(){return{LineWidth:1}},disabledPropertyControls:["FlipX","FlipY","AspectRatio"],variants:{BandedCols:{tooltip:i18n.get("plugin-table-shape-name-banded-cols"),defaultProperties:function(){return{BandedCols:!0,LineWidth:1}}},BandedRows:{tooltip:i18n.get("plugin-table-shape-name-banded-rows"),
defaultProperties:function(){return{BandedRows:!0,LineWidth:1}}},Header:{tooltip:i18n.get("plugin-table-shape-name-table-with-header"),defaultProperties:function(){return{"CellFill_0,0":"#99ccff","CellFill_0,1":"#99ccff","CellFill_0,2":"#99ccff",LineWidth:1}}}},onCreate:function(){lucid.text.blurEditor()},onInit:function(a){lucid.text.filterTextAreas(a,function(b){var e=lucid.plugin.getProperty(a,"SelectedCells",!0);return!lucid.object.some(e,function(a){return a})||e[b.split("_")[1]]});u.common.Table.registerCommonProperties(B,
a);lucid.plugin.registerProxyProperty(a,"GridLines",function(){var b=lucid.plugin.getProperty(a,"HideH"),e=lucid.plugin.getProperty(a,"HideV");return b?e?"none":"columns":e?"rows":"all"},function(b){switch(b){case "all":lucid.plugin.setPropertyIfChanged(a,"HideH",!1);lucid.plugin.setPropertyIfChanged(a,"HideV",!1);break;case "columns":lucid.plugin.setPropertyIfChanged(a,"HideH",!0);lucid.plugin.setPropertyIfChanged(a,"HideV",!1);break;case "rows":lucid.plugin.setPropertyIfChanged(a,"HideH",!1);lucid.plugin.setPropertyIfChanged(a,
"HideV",!0);break;case "none":lucid.plugin.setPropertyIfChanged(a,"HideH",!0),lucid.plugin.setPropertyIfChanged(a,"HideV",!0)}});lucid.plugin.hookPropertyPostSave(a,"HideH",function(){lucid.plugin.proxyPropertyChanged(a,"GridLines")});lucid.plugin.hookPropertyPostSave(a,"HideV",function(){lucid.plugin.proxyPropertyChanged(a,"GridLines")})},pointInShape:function(a,b){return(a=lucid.plugin.getProperty(a,"BoundingBox"))?lucid.math.Box.pointInBox(b,a):!1},getOffsetProperties:function(a,b,e,c,d,g,k,l){function h(a,
b,c,d){var e=[];a.map(function(a,b){return{size:a,index:b}}).sort(function(a,b){return a.size-b.size}).reduce(function(a,c){var d=Math.max(b,a.target/a.current*c.size);e[c.index]=d;return{current:a.current-c.size,target:a.target-d}},{current:d,target:c});return e}function v(b){return h(lucid.plugin.getProperty(a,"ColWidths"),B.MINCOLWIDTH,b.w,p.w)}function n(b){return h(lucid.plugin.getProperty(a,"RowHeights"),B.MINROWHEIGHT,b.h,p.h)}var p=lucid.plugin.getProperty(a,"BoundingBox"),r=lucid.plugin.getProperty(a,
"AspectRatio"),q=lucid.plugin.getProperty(a,"Cols")*B.MINCOLWIDTH,t=lucid.plugin.getProperty(a,"Rows")*B.MINROWHEIGHT;e=lucid.plugin.defaultOffsetProperties(a,b,e,c,d,g,k,l);b={};e[a]&&e[a].BoundingBox&&(e=e[a].BoundingBox,r&&(e.w<q&&(e.w=q,e.h=q/r),e.h<t&&(e.h=t,e.w=r*t)),r=v(e),q=n(e),b[a]={BoundingBox:e,ColWidths:r,RowHeights:q});return b},hitTest:function(a,b){function e(a,b,c){for(var d=0;d<a.length;d++){if(c>b&&c<=b+a[d])return d;b+=a[d]}}if(!(1<lucid.plugin.getSelection().length||lucid.plugin.getProperty(a,
"Lock")||1==lucid.plugin.getSelection().length&&lucid.plugin.getSelection()[0]!=a&&b.shift)){var c=lucid.plugin.getProperty(a,"BoundingBox");if(c){var d=lucid.plugin.getProperty(a,"Rotation"),g=lucid.math.Point.rotate(b,lucid.math.Box.center(c),-d);if(lucid.math.Box.pointInBox(g,{x:c.x-20,y:c.y-20,h:c.h+20,w:c.w+20})){var k=lucid.plugin.getProperty(a,"ColWidths"),l=lucid.plugin.getProperty(a,"RowHeights"),h=u.common.Table.getVisibleCells(a);if(lucid.math.Box.pointInBox(g,c)){var v=lucid.math.Point.subtract(g,
c),n=lucid.object.findValue(h,function(a){return lucid.math.Box.pointInBox(v,a)});if(-1<lucid.plugin.getSelection().indexOf(a)){d=c.x;for(var p=0;p<k.length;p++)if(d+=k[p],g.x>d-5&&g.x<d+5)return;d=c.y;for(p=0;p<l.length;p++)if(d+=l[p],g.y>d-5&&g.y<d+5)return;return{onClick:function(){var c=lucid.plugin.getProperty(a,"SelectedCells",!0);if(!b.shift){if(b.ctrl){u.common.Table.selectCell(B,a,h,c,n.row,n.col,!0);u.common.Table.setSelection(B,a,c);return}var d=lucid.plugin.getProperty(a,"SelectedAnchor",
!0),e=lucid.plugin.getProperty(a,"SelectedCursor",!0);if(d.row==e.row&&d.col==e.col&&d.row==n.row&&d.col==n.col){d=c[n.row+","+n.col];c=u.common.Table.getSelectionFromAnchor(B,a,h);d&&u.common.Table.selectCell(B,a,h,c,n.row,n.col,!0);u.common.Table.setSelection(B,a,c);return}lucid.plugin.setProperty(a,"SelectedAnchor",{row:n.row,col:n.col},!0)}lucid.plugin.setProperty(a,"SelectedCursor",{row:n.row,col:n.col},!0);c=u.common.Table.getSelectionFromAnchor(B,a,h);u.common.Table.setSelection(B,a,c)},onDoubleClick:function(){u.common.Table.setSelection(B,
a,{});lucid.text.focusEditor(a,"Cell_"+n.row+","+n.col)},cursor:"pointer",allowCtrl:!0}}}if(g.x>c.x&&g.y<c.y&&-1<lucid.plugin.getSelection().indexOf(a))return{onClick:function(){var d=e(k,c.x,g.x);var n=b.shift||b.ctrl?lucid.plugin.getProperty(a,"SelectedCells",!0):{};for(var p=0;p<l.length;p++)u.common.Table.selectCell(B,a,h,n,p,d);u.common.Table.setSelection(B,a,n)},cursor:u.common.Table.getCursor("s",d),allowCtrl:!0,allowSelection:!0};if(g.y>c.y&&g.x<c.x&&-1<lucid.plugin.getSelection().indexOf(a))return{onClick:function(){var d=
e(l,c.y,g.y);var n=b.shift||b.ctrl?lucid.plugin.getProperty(a,"SelectedCells",!0):{};for(var p=0;p<k.length;p++)u.common.Table.selectCell(B,a,h,n,d,p);u.common.Table.setSelection(B,a,n)},cursor:u.common.Table.getCursor("e",d),allowCtrl:!0,allowSelection:!0}}}}},beforeDelete:function(a,b,e){return b||u.common.Table.deleteSelection(B,a,e)},preferredTextArea:function(a){a:{var b=u.common.Table.getVisibleSelectedCells(a);if(0!=lucid.object.getKeys(b).length){var e=lucid.plugin.getProperty(a,"Rows");a=
lucid.plugin.getProperty(a,"Cols");for(var c,d=0;d<e;d++)for(var g=0;g<a;g++)if(c=b[d+","+g]){b=c;break a}}b=null}return b?"Cell_"+b.row+","+b.col:null},spatialControlsOnSelect:!0,spatialControls:function(a){var b=[],e=lucid.plugin.getProperty(a,"ColWidths"),c=lucid.plugin.getProperty(a,"RowHeights"),d=lucid.plugin.getProperty(a,"BoundingBox"),g=0;lucid.array.forEach(e,function(c,h){var k=g+=c;b.push({color:"none",location:function(){return{x:d.x+k-6,y:d.y+5,w:12,h:d.h-10}},moved:function(b){b.x=
Math.round(b.x);for(var c=0,k=0;k<h;k++)c+=e[k];b=b.x-c-d.x-e[h];e[h]=Math.round(e[h]+b);h<e.length-1&&(e[h+1]=Math.round(e[h+1]-b));lucid.plugin.setProperty(a,"ColWidths",e)},path:function(){for(var a=0,b=0;b<h;b++)a+=e[b];return[{x:d.x+a+B.MINCOLWIDTH,y:d.y+d.h/2},{x:h<e.length-1?d.x+a+e[h]+e[h+1]-B.MINCOLWIDTH:1E4,y:d.y+d.h/2}]},cursor:function(){return"ew-resize"},snap:2,logAction:"plugin.tables.spatialControls.columnWidth"})});var k=0;lucid.array.forEach(c,function(e,h){var l=k+=e;b.push({color:"none",
location:function(){return{x:d.x+5,y:d.y+l-6,w:d.w-10,h:12}},moved:function(b){for(var e=0,k=0;k<h;k++)e+=c[k];c[h]=Math.round(c[h]+(b.y-e-d.y-c[h]));lucid.plugin.setProperty(a,"RowHeights",c)},path:function(){for(var a=0,b=0;b<h;b++)a+=c[b];return[{x:d.x+d.w/2,y:d.y+a+B.MINROWHEIGHT},{x:d.x+d.w/2,y:1E4}]},cursor:function(){return"ns-resize"},snap:2,logAction:"plugin.tables.spatialControls.rowHeight"})});return b},getRenderData:function(a,b){return u.common.Table.getRenderData(B,a,b)}});
lucid.plugin.registerAdvancedAction(B.BLOCKNAME,"insertColumnLeft",C,function(){return!E()});lucid.plugin.registerAdvancedAction(B.BLOCKNAME,"insertColumnRight",D,function(){return!E()});lucid.plugin.registerAdvancedAction(B.BLOCKNAME,"insertRowTop",F,function(){return!H()});lucid.plugin.registerAdvancedAction(B.BLOCKNAME,"insertRowBottom",G,function(){return!H()});lucid.plugin.registerAdvancedAction(B.BLOCKNAME,"deleteColumn",J,function(){return u.common.Table.canDeleteColumn(B)});
lucid.plugin.registerAdvancedAction(B.BLOCKNAME,"deleteRow",I,function(){return u.common.Table.canDeleteRow(B)});lucid.plugin.registerAdvancedAction(B.BLOCKNAME,"mergeCells",K,function(){return!L()});lucid.plugin.registerAdvancedAction(B.BLOCKNAME,"unmergeCells",M,function(){return!N()});lucid.clipboard.beforePaste(u.common.Table.beforePaste.bind(null,B),!0);
function O(a){a=a.replace(/\r\n/g,"\n").split("\n");0==a[a.length-1].length&&a.pop();a=a.map(function(a){return a.split("\t")});var b=a[0].length;return lucid.array.every(a,function(a){return a.length==b})?a:!1}lucid.clipboard.beforeTextPaste(function(a,b,e){if(lucid.plugin.getBlockClassName(a)==B.BLOCKNAME&&(e=O(e))){var c=b.split("_")[1].split(",").map(function(a){return parseInt(a,10)});b=c[0];c=c[1];if(null==lucid.text.getCaretLocation())return u.common.Table.pasteCells(B,a,b,c,e),!1}return!0});
lucid.plugin.onSelectionChange(function(){u.common.Table.deselectAllCells(B,[lucid.plugin.getActivePageId()])});
lucid.plugin.addContextMenuItems(function(){function a(a,b){var c=a[0];return c&&g(a)&&d(b,c)}function b(a,b){var d=a[0];return d&&g(a)&&0<=c(b.x,lucid.plugin.getProperty(d,"BoundingBox").x,lucid.plugin.getProperty(d,"ColWidths"))}function e(a,b){var d=a[0];return d&&g(a)&&0<=c(b.y,lucid.plugin.getProperty(d,"BoundingBox").y,lucid.plugin.getProperty(d,"RowHeights"))}function c(a,b,c){for(var d=0;d<c.length;d++){if(a>=b&&a<=b+c[d])return d;b+=c[d]}return-1}function d(a,b){var c=u.common.Table.getVisibleCells(b);
b=lucid.plugin.getProperty(b,"BoundingBox");var d=lucid.math.Point.subtract(a,b);return lucid.object.findValue(c,function(a){return lucid.math.Box.pointInBox(d,a)})}function g(a){return lucid.plugin.inReadOnlyMode()||!a||1!=a.length?!1:lucid.plugin.getBlockClassName(a[0])==B.BLOCKNAME}return[{external:!0,label:i18n.get("plugin-table-contextmenu-add-row-above"),logAction:"plugin.table.contextMenu.addrow.above",action:function(a,b){b=b[0];var c=lucid.plugin.getAllProperties(b);a=d(a,b);u.common.Table.addRow(B,
b,c,a,!0)},visible:a},{external:!0,label:i18n.get("plugin-table-contextmenu-add-row-below"),logAction:"plugin.table.contextMenu.addrow.below",action:function(a,b){b=b[0];var c=lucid.plugin.getAllProperties(b);a=d(a,b);u.common.Table.addRow(B,b,c,a,!1)},visible:a},{external:!0,label:i18n.get("plugin-table-contextmenu-delete-row"),logAction:"plugin.table.contextMenu.deleterow",action:function(a,b){b=b[0];var d=lucid.plugin.getAllProperties(b);a=c(a.y,d.BoundingBox.y,d.RowHeights);u.common.Table.deleteRow(B,
b,d,a)},visible:e},{external:!0,label:i18n.get("plugin-table-contextmenu-clear-row"),logAction:"plugin.table.contextMenu.clearrow",action:function(a,b){b=b[0];var d=lucid.plugin.getAllProperties(b);a=c(a.y,d.BoundingBox.y,d.RowHeights);for(d=0;d<lucid.plugin.getProperty(b,"Cols");d++)lucid.plugin.setProperty(b,"Cell_"+a+","+d,"")},visible:e},{external:!0,label:i18n.get("plugin-table-contextmenu-add-col-left"),logAction:"plugin.table.contextMenu.addcolumn.left",action:function(a,b){b=b[0];var c=lucid.plugin.getAllProperties(b);
a=d(a,b);u.common.Table.addColumn(B,b,c,a,!0)},visible:a},{external:!0,label:i18n.get("plugin-table-contextmenu-add-col-right"),logAction:"plugin.table.contextMenu.addcolumn.right",action:function(a,b){b=b[0];var c=lucid.plugin.getAllProperties(b);a=d(a,b);u.common.Table.addColumn(B,b,c,a,!1)},visible:a},{external:!0,label:i18n.get("plugin-table-contextmenu-delete-column"),logAction:"plugin.table.contextMenu.deletecolumn",action:function(a,b){b=b[0];var d=lucid.plugin.getAllProperties(b);a=c(a.x,
d.BoundingBox.x,d.ColWidths);u.common.Table.deleteColumn(B,b,d,a)},visible:b},{external:!0,label:i18n.get("plugin-table-contextmenu-clear-column"),logAction:"plugin.table.contextMenu.clearcolumn",action:function(a,b){b=b[0];var d=lucid.plugin.getAllProperties(b);a=c(a.x,d.BoundingBox.x,d.ColWidths);for(d=0;d<lucid.plugin.getProperty(b,"Rows");d++)lucid.plugin.setProperty(b,"Cell_"+d+","+a,"")},visible:b}]}());
lucid.plugin.createToolGroups({Tables:{displayName:i18n.get("plugin-table-toolgroup-header"),items:[B.BLOCKNAME,{className:"DefaultTableBlock",variant:"BandedRows",name:"TableBandedRows"},{className:"DefaultTableBlock",variant:"BandedCols",name:"TableBandedCols"},{className:"DefaultTableBlock",variant:"Header",name:"TableHeader"}]}});
//# sourceMappingURL=/js/plugins/v2/source-maps/table.js.map

};
